[comment encoding = UTF-8 /]
[module toTina('platform:/resource/fr.n7.petriNet/PetriNet.ecore')]

[comment Requête pour formater l'arc entrant Place -> Transition (ex: p1 ou p2 2) /]
[query public toTinaIn(a : ArcPlaceTransition) : String = 
	if a.weight = 1 then a.source.name else a.source.name + ' ' + a.weight endif
/]

[comment Requête pour formater l'arc sortant Transition -> Place (ex: p3 ou p5 1) /]
[query public toTinaOut(a : ArcTransitionPlace) : String = 
	if a.weight = 1 then a.target.name else a.target.name + ' ' + a.weight endif
/]


[template public netToTina(aNet : PetriNet)]
[comment @main/]
[file (aNet.name + '.net', false, 'UTF-8')]
net [aNet.name/]

[comment Génération des Places (pl) : utilise aNet.places et p.initialMarketing /]
[for (p : Place | aNet.places)]
pl [p.name/] ([p.initialMarketing/])
[/for]

[comment Génération des Transitions (tr) : sans bornes temporelles /]
[for (t : Transition | aNet.transitions)]
tr [t.name/]
	[t.arcsEntrants->collect(a | a.toTinaIn())->sep(' ')/] -> [t.arcsSortants->collect(a | a.toTinaOut())->sep(' ')/]

[/for]
[/file]
[/template]