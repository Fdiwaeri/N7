#include <stdio.h>
#include <stdlib.h>
#include <sys/types.h> // ces trois sont
#include <sys/stat.h>  // pour permettre
#include <fcntl.h>     // l'utilisation de open
#include <unistd.h>    // pour read

#define BUFSIZE 50

int main(int argc, char** argv){
    int source, destination;
    
    // Vérification du nombre d'arguments données
    if (argc != 3){
        printf("usage: %s source destination", argv[0]);
        exit(EXIT_FAILURE);
    }
    
    char tab[BUFSIZE];
    ssize_t lus, ecrits;
    
    // Ouverture du fichier source en mode lecture
    if ((source = open(argv[1], O_RDONLY)) == -1){
        perror("ouverture de source\n");
        exit(EXIT_FAILURE);
    }
    
    // Ouverture ou création du fichier destination en mode écriture
    if ((destination = open(argv[2], O_WRONLY|O_CREAT|O_TRUNC, 0644)) == -1){
        perror("overture de destination\n");
        exit(EXIT_FAILURE);
    }
    
    // Lecture des données du fichier source fragment par fragment
    while ((lus = read(source, tab, BUFSIZE)) > 0){
        ecrits = write(destination, tab, lus);
        // Vérification de la conformité du nombre de bits écrits et lus
        if (lus != ecrits){
            perror("Lecture et/ou Écriture");
            exit(EXIT_FAILURE);
        }
    }
    close(source);
    close(destination);
    return EXIT_SUCCESS;
}
